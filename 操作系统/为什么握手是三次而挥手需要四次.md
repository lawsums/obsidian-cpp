
DECK: 面试题

## 为什么握手是三次而挥手需要四次


## 标准答案

在 TCP 协议中，握手（建立连接）需 3 次、挥手（关闭连接）需 4 次，核心原因是**连接建立的“双向同步”可通过 3 次交互完成，而连接关闭的“双向释放”需 4 次交互才能彻底确认**，具体解析如下：

### 一、三次握手：高效实现“双向连接就绪”
TCP 是面向连接的协议，建立连接时需确保**双方都明确“自己能发、对方能收”**，3 次交互即可完成这一目标：
1. **客户端→服务器（SYN）**：客户端发送“同步请求”，告知服务器“我要连你，我的初始序号是 X”，此时客户端进入“同步已发送”状态；
2. **服务器→客户端（SYN+ACK）**：服务器收到请求后，先回复“确认（ACK）”表示“我收到你的请求了”，再发送“同步（SYN）”告知客户端“我也准备好连你，我的初始序号是 Y”，此时服务器进入“同步已接收”状态；
3. **客户端→服务器（ACK）**：客户端收到服务器的“SYN+ACK”后，回复“确认（ACK）”表示“我收到你的同步了，现在咱俩都就绪”，此时客户端和服务器均进入“连接已建立”状态。

简言之：第 1 次客户端发起同步，第 2 次服务器同时完成“确认客户端”和“发起自身同步”，第 3 次客户端确认服务器同步——**一次交互可同时承载“确认”和“同步”，因此 3 次即可实现双向就绪**。


### 二、四次挥手：必须分步骤确认“双向释放”
关闭连接时，TCP 需确保**双方都明确“自己已发完数据、对方也已收完数据”**，但因“关闭请求”和“数据传输”可能并行，无法像握手那样“一次交互承载双任务”，需 4 次交互：
1. **客户端→服务器（FIN）**：客户端数据发完，发送“结束请求（FIN）”，表示“我不再发数据了，但我还能收你的数据”，客户端进入“终止等待 1”状态；
2. **服务器→客户端（ACK）**：服务器收到 FIN 后，先回复“确认（ACK）”表示“我知道你不发了，但我可能还有数据没发完，你等我”，此时服务器进入“关闭等待”状态，客户端进入“终止等待 2”状态（仅等服务器的 FIN）；
3. **服务器→客户端（FIN）**：服务器处理完剩余数据后，发送“结束请求（FIN）”，表示“我也不发数据了，你可以关了”，服务器进入“最后确认”状态；
4. **客户端→服务器（ACK）**：客户端收到 FIN 后，回复“确认（ACK）”表示“我知道你也发完了”，客户端进入“时间等待”（确保服务器收到确认），服务器收到 ACK 后彻底关闭连接。

简言之：**关闭时，“确认对方关闭请求”和“自身发起关闭请求”必须分开——服务器需先确认客户端的 FIN（第 2 次），待自身数据发完再发 FIN（第 3 次），因此需 4 次交互才能彻底释放双向资源**。

## 我的答案



END
<!--ID: 1765943272215-->
