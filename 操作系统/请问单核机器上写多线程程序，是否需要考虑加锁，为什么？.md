
DECK: 面试题

## 请问单核机器上写多线程程序，是否需要考虑加锁，为什么？


## 标准答案

在单核机器上写多线程程序，仍然需要线程锁。因为线程锁通常用来实现线程的同步和通信。在单核机器上的多线程程序，仍然存在线程同步的问题。因为在抢占式操作系统中，通常为每个线程分配一个**时间片**，当某个线程时间片耗尽时，操作系统会将其挂起，然后运行另一个线程。如果这两个线程共享某些数据，**不使用线程锁的前提下，可能会导致共享数据修改引起冲突**。

## 我的答案

需要，因为单核的进程是一个，但是线程不只有一个，在执行任务的时候因为有时间片轮转，如果没有锁的话，两个线程如果同时更改一个变量，但是两者在任意一个线程还没有执行完的时候去获取值的话就违反了程序员的本意，那就错了

比如说同时执行一个如下的程序
``` cpp 
int a = *p; // 一开始*p = 0
pause(1); // 暂停一秒
*p = a + 1;
```

我们有两个线程，我们希望他们都执行一次，理论上得到的结果应该是\*p = 2，因为自增了两次

线程一获取到a = \*p = 0
然后pause

此时线程二获取到a = \*p = 0
然后线程二pause 

然后线程一恢复过来
\*p =  a+1 = 1

然后线程二恢复过来
\*p =  a+1 = 1

但是和我们想要的结果是不符的  

END
<!--ID: 1763910984625-->
